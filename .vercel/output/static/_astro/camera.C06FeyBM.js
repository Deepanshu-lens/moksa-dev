import{i as C}from"./legacy.B9Y3TeRD.js";import{p as g,l as b,a as $,b as y}from"./effects.D69rIdB6.js";import{b as _}from"./props.G6l1d_aD.js";import{s as v,a as f}from"./store.LwFfO3GU.js";import{p as c,v as p}from"./pb.BjVtZEqq.js";import{u}from"./user.DTKNVqgd.js";import{c as o,t as T}from"./camera.tm09y8tp.js";import{s as D}from"./node.BMRk-V2q.js";import"./ui.BlnsDfWm.js";import"./index.PDEF5wc2.js";function Z(N,l){g(l,!1);const n=v(),i=()=>f(u,"$user",n),s=()=>f(D,"$selectedNode",n),h=async r=>{let a;r==="all"?a=`session ?= "${i()?.session}"`:a=`node.id ?= "${r}"`;try{const e=await c.collection("camera").getFullList({fields:"id,name,url,subUrl,save,saveDuration,created,node,fps,motionThresh,face,person,faceDetThresh,faceMatchThresh,personDetThreshold,timeZone,streamType,recordQuality,isRoiEnabled,roiCanvasCoordinates,roiRectangleCoordinates",filter:a,sort:"created"});o.set(e),T.set(e.length)}catch(e){console.error("Error initializing Camera Manager:",e)}},d=async()=>{console.log(u,"user")};return b(()=>(s(),i(),o),()=>{if(s()){h(s()),c.collection("camera").unsubscribe("*");let r;s()==="all"?r=`session ?= "${i()?.session}"`:r=`node.id ?= "${s()}"`;try{c.collection("camera").subscribe("*",a=>{if(a.action==="create"){const e=p(a.record);e&&o.update(t=>[...t,e])}else if(a.action==="update"){const e=p(a.record);e&&o.update(t=>t.map(m=>m.id===e.id?e:m))}else a.action==="delete"&&o.update(e=>e.filter(t=>t.id!==a.record.id))},{filter:r})}catch{console.error("Failed realtime camera")}}}),$(),C(),_(l,"getTotalCamerasCount",d),y({getTotalCamerasCount:d})}export{Z as default};

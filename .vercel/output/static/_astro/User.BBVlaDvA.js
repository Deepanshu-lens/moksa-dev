import{i as s}from"./legacy.CS2Xrhg9.js";import{p as l,b as c}from"./effects.BhUQh3a6.js";import{o as p}from"./index-client.CAqXSNTC.js";import{p as t,a as d}from"./pb.BjVtZEqq.js";import{u as a}from"./user.DTKNVqgd.js";function L(h,n){l(n,!1);async function r(){return window.api?(console.log("ELECTRON"),await window.api.invoke("get-auth-token")):localStorage.getItem("pb_auth_token")}try{t.collection("users").subscribe("*",e=>{if(e.action==="update"){const o=d(e.record);o&&a.update(i=>i&&(i.id===o.id?o:i))}})}catch{console.error("Failed realtime user")}p(()=>{r().then(e=>{if(e)t.authStore.model||(t.authStore.save(e),t.collection("users").authRefresh().catch(()=>{console.error("Failed to refresh authentication.")})),a.set(t.authStore.model);else if(window.api){const o=/\/login(\.html)?$/.test(window.location.pathname)||/\/register(\.html)?$/.test(window.location.pathname);console.log("CALLED FROM User",o),o||window.api.navigate("/login")}else window.location.pathname==="/login"||window.location.pathname==="/register"||(window.location.href="/login")})}),s(),c()}export{L as default};

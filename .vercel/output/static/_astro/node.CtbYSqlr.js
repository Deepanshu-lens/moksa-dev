import{i as m}from"./legacy.BEeXhY1S.js";import{p,b as f}from"./effects.cxkQmux7.js";import{s as u,a as g}from"./store.c-pxfM0-.js";import{p as r}from"./pb.BjVtZEqq.js";import{n as o,s as a}from"./node.CqL_Mp_Y.js";import"./ui.4do1Kz16.js";import"./index.BUf4ql09.js";function h(l){return new Promise(i=>setTimeout(i,l))}function A(l,i){p(i,!1);const c=u(),d=()=>g(o,"$nodes",c);async function n(){const e=await r.collection("node").getFullList({fields:"id,name",filter:`session.id?="${r.authStore.model?.session[0]}"`,sort:"-created"});e.length>0?o.set([{id:"all",name:"All"},...e]):o.set(e),e.length>0&&(localStorage.getItem("$selectedNode")&&[{id:"all",name:"All"},...e].filter(t=>t.id===localStorage.getItem("$selectedNode")).length>0?a.set(localStorage.getItem("$selectedNode")??""):a.set(e[0].id))}(async()=>{try{await n()}catch(e){console.error("Error initializing Node Manager:",e),await h(3e3),await n()}})();try{r.collection("node").subscribe("*",e=>{e.action==="create"?o.update(t=>[...t,e.record]):e.action==="update"?o.update(t=>t.map(s=>s.id===e.record.id?e.record:s)):e.action==="delete"&&(o.update(t=>t.filter(s=>s.id!==e.record.id)),d().length>0&&a.set(d()[0].id))},{filter:`session.id?="${r.authStore.model.session[0]}"`})}catch{console.error("Failed realtime camera")}m(),f()}export{A as default};

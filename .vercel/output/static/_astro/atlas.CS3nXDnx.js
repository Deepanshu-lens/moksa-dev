import{i as c}from"./legacy.B9Y3TeRD.js";import{p,b as d}from"./effects.D69rIdB6.js";import{s as f,a as u}from"./store.LwFfO3GU.js";import{p as s}from"./pb.BjVtZEqq.js";import{u as m}from"./user.DTKNVqgd.js";import{i as o,p as t,a as $}from"./panels.0CsNYxja.js";import"./ui.BlnsDfWm.js";import"./index.PDEF5wc2.js";function _(g,i){p(i,!1);const l=f(),n=()=>u(m,"$user",l);(async()=>{o.set(!0);try{s.autoCancellation(!1);const e=await s.collection("atlas").getFullList({expand:"users,doors",filter:`session.id = "${n()?.session[0]}"`});t.set(e),e.length>0&&$.set(e[0].id)}catch(e){console.error("Error initializing Panel Manager:",e)}finally{o.set(!1)}})();try{s.autoCancellation(!1),s.collection("atlas").subscribe("*",e=>{e.action==="create"?t.update(a=>[...a,e.record]):e.action==="update"?t.update(a=>a.map(r=>r.id===e.record.id?e.record:r)):e.action==="delete"&&t.update(a=>a.filter(r=>r.id!==e.record.id))})}catch{console.error("Failed realtime panel")}c(),d()}export{_ as default};

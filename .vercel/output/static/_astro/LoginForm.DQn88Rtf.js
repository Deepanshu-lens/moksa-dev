import{i as R}from"./legacy.CS2Xrhg9.js";import{p as X,b as Y,e as o,f as Z,s as i,r,t as j}from"./effects.BhUQh3a6.js";import{s as T}from"./render.B8Ti1KQa.js";import{i as y}from"./attributes.Bzn9xiO9.js";import{e as tt,a as l,t as et,c as at,b as f}from"./template.gBe-IW8Y.js";import{a as ot}from"./create.DJFv7QJ3.js";import{s as rt,a as B}from"./store.Cu8l1F6D.js";import{p as d,u as st}from"./pb.BjVtZEqq.js";import{I as D}from"./input.BKj2mia6.js";import{t as x}from"./Toaster.svelte_svelte_type_style_lang.BeLkcojC.js";import{v as it}from"./index.DY4kEioI.js";import{I as E}from"./Icon.BHk6ogbY.js";import{u as nt}from"./user.DTKNVqgd.js";import"./ui.AXpcjr67.js";import{B as lt}from"./button.KrNygnVt.js";import{a as mt}from"./authLogs.Cvxf9YN5.js";import{c as dt}from"./create-form.Dfv7Pl4p.js";import"./index.Syity6yz.js";import"./index-client.CAqXSNTC.js";import"./input.sl8v-pyr.js";import"./props.B2sXXNEW.js";import"./utils.CC9b3hXT.js";import"./html.CGpePhbg.js";import"./this.CmfLgYlZ.js";import"./userDetails.C512u9q6.js";var ct=et(`<form class="space-y-4 w-full"><div class="grid w-full max-w-sm items-center gap-1.5"><div class="relative"><!> <!></div> <div class="text-rose-500 text-xs"><!></div></div> <div class="grid w-full max-w-sm items-center pb-4"><div class="relative"><!> <!></div> <div class="text-rose-500 text-xs"><!></div></div> <div class="flex flex-col items-center justify-between mb-10 sm:mb-0"><!> <button class="inline-block cursor-pointer align-baseline font-bold text-sm text-[#797c80] /[.7] mt-4">Don't have an account yet? <span class="ml-1 text-primary font-semibold">Sign up</span></button></div></form>`);function Ct(L,O){X(O,!1);const _=rt(),c=()=>B(N,"$errors",_),k=()=>B(V,"$isSubmitting",_);d.authStore.token&&d.authStore.clear();const C=st.pick({email:!0}),{form:J,errors:N,reset:U,isSubmitting:V}=dt({initialValues:{email:"",password:""},extend:it({schema:C}),onSubmit:async t=>{if(!await W(t.email,t.password)){U();return}await mt("login",t.email),window.api?window.api.navigate("/index"):window.location.href="/"},onError:t=>{console.log("Form validation failed:",t)}});async function W(t,a){let s;try{s=await d.collection("users").authWithPassword(t,a)}catch(e){if(e.message==="Failed to authenticate."){x.error("Invalid email or password. Please try again.");return}x.error("Authentication failed. Please try again.")}try{await fetch("https://api.moksa.ai/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})}).then(async e=>{const m=await e.json();if(m.data&&m.data.token){const h=m.data.token;localStorage.setItem("moksa-token",h)}else console.log("Token not found in response")}).catch(e=>{console.log(e)})}catch(e){console.log(e,"error here"),console.log("login error",e.message===void 0?"User not found":e.message)}if(s)return nt.set(s.record),window.api?await window.api.invoke("save-auth-token",d.authStore.token):localStorage.setItem("pb_auth_token",d.authStore.token),s;x.error("Authentication failed. Please try again.")}R();var p=ct(),u=o(p),v=o(u),S=o(v);E(S,{icon:"material-symbols:mail-rounded",class:"w-22 h-22 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"});var q=i(S,2);D(q,{type:"email",name:"email",placeholder:"Email Address",class:"pl-10 w-full border border-gray-300 rounded-md"}),r(v);var $=i(v,2),z=o($);{var G=t=>{var a=f();j(()=>T(a,c().email)),l(t,a)};y(z,t=>{c().email&&t(G)})}r($),r(u);var g=i(u,2),w=o(g),I=o(w);E(I,{icon:"material-symbols:password",class:"w-22 h-22 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"});var H=i(I,2);D(H,{type:"password",name:"password",placeholder:"Password",class:"pl-10 w-full border border-gray-300 rounded-md"}),r(w);var P=i(w,2),K=o(P);{var M=t=>{var a=f();j(()=>T(a,c().password)),l(t,a)};y(K,t=>{c().password&&t(M)})}r(P),r(g);var A=i(g,2),F=o(A);lt(F,{get disabled(){return k()},type:"submit",class:"disabled:cursor-not-allowed bg-[#015A62] hover:bg-[#015A62]/[.4] text-white font-bold py-2 px-4 rounded-md w-full focus:outline-none focus:shadow-outline",children:(t,a)=>{var s=at(),e=Z(s);{var m=n=>{var b=f("Submitting ...");l(n,b)},h=n=>{var b=f("Sign In");l(n,b)};y(e,n=>{k()?n(m):n(h,!1)})}l(t,s)},$$slots:{default:!0}});var Q=i(F,2);r(A),r(p),ot(p,t=>J?.(t)),tt("click",Q,()=>{window.api?window.api.navigate("/register"):window.location.href="/register"}),l(L,p),Y()}export{Ct as default};

import{i as S}from"./legacy.CS2Xrhg9.js";import{p as v,l as h,a as y,b as $,g as c,m as _,c as N}from"./effects.BhUQh3a6.js";import{s as E,a as I}from"./store.Cu8l1F6D.js";import{p as a}from"./pb.BjVtZEqq.js";import{o as w}from"./index-client.CAqXSNTC.js";import{s as B}from"./node.Bxisulq9.js";import{l as p}from"./live-events.HXIrV1Sk.js";import"./ui.AXpcjr67.js";import{t as F}from"./Toaster.svelte_svelte_type_style_lang.BeLkcojC.js";import"./index.Syity6yz.js";function C(P,d){v(d,!1);const m=E(),s=()=>I(B,"$selectedNode",m);let i=_();const u=90,f=20;let l,o="/level-up.mp3";w(()=>{let e=window.localStorage.getItem("alertSound")||"Short Beep";e==="Notification"?o=localStorage.getItem("alertSound")||"/notification-alert.mp3":e==="Public Beep"?o="/public-beep-sound.mp3":e==="Short Beep"?o="/short-beep-tone.mp3":o="/level-up.mp3"});const g=(e,r)=>{let t=JSON.parse(localStorage.getItem(r)),n=JSON.parse(localStorage.getItem(e));n&&(t=n),t==="Notification"?o=localStorage.getItem("alertSound")||"/notification-alert.mp3":t==="Public Beep"?o="/public-beep-sound.mp3":t==="Short Beep"?o="/short-beep-tone.mp3":o="/level-up.mp3",l=new Audio(`/notification-sounds/${localStorage.getItem("alertSound")||o}`),l.play()},b=()=>{try{if(!s())return;N(i,a.collection("events").subscribe("*",e=>{e.action==="create"?p.update(r=>{const t=[e.record,...r];return t.length>u&&t.splice(0,f),F.warning(`Event detected: ${e?.record?.title}`),g(e?.record?.severity,e?.record?.type),t}):e.action==="update"&&p.update(r=>r.map(t=>t.id===e.record.id?e.record:t))},{filter:`node?="${s()}"`}))}catch(e){console.error("Failed to subscribe to real-time events:",e)}};h(()=>(s(),c(i),a),()=>{if(s())try{c(i)&&a.collection("events").unsubscribe("*"),b()}catch(e){console.error("Error while managing subscriptions:",e)}}),y(),S(),$()}export{C as default};

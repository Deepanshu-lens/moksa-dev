import{i as c}from"./legacy.CS2Xrhg9.js";import{p as l,l as p,a as d,b as f}from"./effects.BhUQh3a6.js";import{s as m,a as u}from"./store.Cu8l1F6D.js";import{p as a}from"./pb.BjVtZEqq.js";import{a as v}from"./panels.Cbe4C8wU.js";import{e as t}from"./events.D3ZRZFsE.js";import"./ui.AXpcjr67.js";import{t as g}from"./Toaster.svelte_svelte_type_style_lang.BeLkcojC.js";import"./index.Syity6yz.js";function z(_,i){l(i,!1);const n=m(),o=()=>u(v,"$activePanel",n);(async()=>{try{a.autoCancellation(!1);const e=await a.collection("atlas_events").getFullList({filter:`pannels="${o()}"`,sort:"-created",expand:"user"});t.set(e),e.length>0}catch(e){console.error("Error initializing Panel Manager:",e)}})();try{a.collection("atlas_events").subscribe("*",e=>{e.action==="create"?(console.log("door unlocked",e.record),t.update(r=>[e.record,...r]),g.success("New event created",{description:`${e.record.description} on ${e.record.deviceName}`})):e.action==="update"?t.update(r=>r.map(s=>s.id===e.record.id?e.record:s)):e.action==="delete"&&t.update(r=>r.filter(s=>s.id!==e.record.id))},{expand:"user"})}catch{console.error("Failed realtime events")}p(()=>(o(),t),()=>{o()&&(async()=>{try{a.autoCancellation(!1);const e=await a.collection("atlas_events").getFullList({filter:`pannels="${o()}"`,sort:"-created",expand:"user"});t.set(e),e.length>0}catch(e){console.error("Error initializing Panel Manager:",e)}})()}),d(),c(),f()}export{z as default};

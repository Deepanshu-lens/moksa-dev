import{i as c}from"./legacy.BEeXhY1S.js";import{p as l,l as p,a as d,b as f}from"./effects.cxkQmux7.js";import{s as m,a as u}from"./store.c-pxfM0-.js";import{p as a}from"./pb.BjVtZEqq.js";import{a as v}from"./panels.BHf2sUYG.js";import{e as t}from"./events.BP2a3zZT.js";import"./ui.4do1Kz16.js";import{t as g}from"./Toaster.svelte_svelte_type_style_lang.DfPlDrph.js";import"./index.BUf4ql09.js";function z(_,i){l(i,!1);const n=m(),o=()=>u(v,"$activePanel",n);(async()=>{try{a.autoCancellation(!1);const e=await a.collection("atlas_events").getFullList({filter:`pannels="${o()}"`,sort:"-created",expand:"user"});t.set(e),e.length>0}catch(e){console.error("Error initializing Panel Manager:",e)}})();try{a.collection("atlas_events").subscribe("*",e=>{e.action==="create"?(console.log("door unlocked",e.record),t.update(r=>[e.record,...r]),g.success("New event created",{description:`${e.record.description} on ${e.record.deviceName}`})):e.action==="update"?t.update(r=>r.map(s=>s.id===e.record.id?e.record:s)):e.action==="delete"&&t.update(r=>r.filter(s=>s.id!==e.record.id))},{expand:"user"})}catch{console.error("Failed realtime events")}p(()=>(o(),t),()=>{o()&&(async()=>{try{a.autoCancellation(!1);const e=await a.collection("atlas_events").getFullList({filter:`pannels="${o()}"`,sort:"-created",expand:"user"});t.set(e),e.length>0}catch(e){console.error("Error initializing Panel Manager:",e)}})()}),d(),c(),f()}export{z as default};

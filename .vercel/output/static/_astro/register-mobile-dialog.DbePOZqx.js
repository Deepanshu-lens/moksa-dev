import{i as Ne}from"./legacy.B9Y3TeRD.js";import{p as We,l as ae,a as Je,b as Le,g as e,c as s,f as w,t as se,m as j,s as r,w as B,i as k,r as v,j as H,x as M}from"./effects.D69rIdB6.js";import{b as z,a as o,e as oe,t as b,c as qe}from"./template.BAXcjkkR.js";import{i as le,r as ie,s as xe,c as G,b as he}from"./attributes.CKLvY0ho.js";import{e as we,i as ye}from"./each.Btj6gPjv.js";import{s as Ee,b as $e}from"./this.Dn7i68im.js";import{s as K}from"./class.aRYY48yX.js";import{b as He}from"./input.wlVNyH1y.js";import{s as Me,a as je}from"./store.LwFfO3GU.js";import{t as C}from"./Toaster.svelte_svelte_type_style_lang.BVmv9t-o.js";import{w as ne}from"./index.PDEF5wc2.js";import{R as ze,T as Ge,D as Ke,a as Qe,b as Ve}from"./index.DgIroXGH.js";import{I as Xe}from"./input.skk1M_av.js";import{B as ke}from"./index.B4oxMXhh.js";import{c as Pe}from"./utils.7i5Ab_63.js";import{u as Ye}from"./user.DTKNVqgd.js";import"./pb.BjVtZEqq.js";import"./ui.BlnsDfWm.js";import{a as Ze}from"./userLogs.FmCv2qlm.js";import{D as et}from"./dialog-description.DLfF4S9z.js";import{C as tt}from"./chevron-down.C5AO3RM7.js";import{D as rt}from"./dialog-footer.Cr4M3bkH.js";var at=b("<!> <!>",1),st=b('<div class="w-full"></div>'),ot=b('<div style="margin: 5px;"><img alt="captured" width="100px"></div> <!>',1),lt=b('<video class=" w-[80%] aspect-square self-center mx-auto"></video> <div class="flex flex-wrap justify-center"></div> <canvas style="display: none;"></canvas> <!>',3),it=b('<div class="w-full"></div>'),nt=b('<div style="margin: 5px;"><img alt="captured" width="100px"></div> <!>',1),dt=b('<p class="text-[#00132B] dark:text-slate-100">Upload a folder</p> <input class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-[#015A62] focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50" type="file" multiple id="flder" webkitdirectory> <p class="text-[#00132B] dark:text-slate-100">Upload single images</p> <!> <div class="flex flex-wrap justify-center"></div>',1),ct=b('<!> <div class="w-full flex flex-col items-start justify-center py-4 gap-4"><p class="text-[#00132B] dark:text-slate-100">Choose from the options below to register your images</p> <span class="flex items-center justify-start w-full gap-4"><button><input type="radio"> Capture image live</button> <button><input type="radio"> Upload Image</button></span> <label for="username" class=" text-[#00132B] dark:text-slate-100">Username</label> <span class="relative w-full"><input name="Person Name" type="text" class="w-full h-[48px] relative rounded-lg pl-4 border-[2px] border-solid border-[rgb(145,158,171)]/[.24] focus:border-[#136ad5] placeholder-[#939393] bg-background" placeholder="Type or select name"> <!></span></div> <!> <!>',1),pt=b("<!> <!>",1);function Ot(Se,de){We(de,!1);const ce=Me(),I=()=>je(T,"$registrationImages",ce),pe=()=>je(Ye,"$user",ce);let m=j(!1),g=j(1),P=j("");const T=ne([]),fe=ne([]),me=ne(),Q="https://ai.lenscorp.cloud/face";let n=j(),_=j(),U=j();const De=async()=>{try{s(U,await navigator.mediaDevices.getUserMedia({video:!0})),M(n,e(n).srcObject=e(U)),e(n).play()}catch(t){console.log(t)}},Be=async()=>{e(U).getTracks().forEach(t=>{console.log(t),t.readyState=="live"&&t.kind==="video"&&(t.stop(),t.enabled=!1),M(n,e(n).srcObject=null)})};let S=j(!1);async function Ce(){const t=e(_).getContext("2d");if(t){M(_,e(_).width=e(n).videoWidth),M(_,e(_).height=e(n).videoHeight),t.drawImage(e(n),0,0,e(n).videoWidth,e(n).videoHeight),s(S,!0);let y=e(_).toDataURL("image/jpeg");const l=await fetch(`${Q}/get_crop_align`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:[y.replace(/^data:[^,]+,/,"")]})});if(!l.ok){const d=(await l.json()).error;console.error(d),C.error("Something went wrong. Please try another"),s(S,!1);return}const a=await l.json();s(S,!1),T.update(d=>[...d,a?.cropped_images?.[0]])}}async function Ie(t){return new Promise((y,l)=>{const a=new FileReader;a.onload=()=>{y(a.result)},a.onerror=d=>{l(d)},a.readAsDataURL(t)})}const ge=async t=>{console.log(t.target.files);const y=Array.from(t.target.files).filter(l=>l.name!==".DS_Store"&&l.type!=="");if(y.length>0)for(const l of y)try{let a=await Ie(l);const d=await fetch(`${Q}/get_crop_align`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:[a.replace(/^data:[^,]+,/,"")]})});if(console.log("File upload status:",d.status),!d.ok){const R=(await d.json()).error;console.error("Error:",R),C.error("Something went wrong. Please try another"),s(S,!1);return}const{cropped_images:O}=await d.json();s(S,!1),T.update(R=>[...R,...O])}catch(a){console.error(a),C.error(a?.message||"Something went wrong. Please try another file.")}},Te=()=>{try{fetch(`${Q}/set_gallery_features`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e(P),image:[...I()]})}).then(()=>{Ze("User added person to gallery",pe()?.email||"",pe()?.id||""),C.success(`${e(P)} successfully added to gallery`),T.set([]),fe.set([]),me.set(null),s(P,""),s(m,!1)}).catch(t=>{console.log(t?.message,"error while register face"),C.error(t?.message||"something went wrong while adding person!!")})}catch(t){console.log(t?.message,"erorr here"),C.error(t?.message||"something went wrong while adding person!!")}};ae(()=>e(m),()=>{e(m)||(T.set([]),fe.set([]),me.set(null))}),ae(()=>(e(m),e(g)),()=>{e(m)&&e(g)==1&&(console.log("!"),De())}),ae(()=>(e(m),e(U)),()=>{!e(m)&&e(U)&&(console.log("Closing"),Be())}),Je(),Ne(),ze(Se,{get open(){return e(m)},set open(t){s(m,t)},children:(t,y)=>{var l=pt(),a=w(l);Ge(a,{children:(O,R)=>{var F=qe(),L=w(F);Ee(L,de,"default",{},null),o(O,F)},$$slots:{default:!0}});var d=r(a,2);Ke(d,{class:"w-[90%] max-h-[70%] z-[60] overflow-y-scroll overflow-x-clip top-10 translate-y-0",children:(O,R)=>{var F=ct(),L=w(F);Qe(L,{class:"w-full",children:(c,$)=>{var f=at(),p=w(f);Ve(p,{children:(u,N)=>{B();var i=z("Register Face");o(u,i)},$$slots:{default:!0}});var x=r(p,2);et(x,{children:(u,N)=>{B();var i=z("Register a new person to the Gallery");o(u,i)},$$slots:{default:!0}}),o(c,f)},$$slots:{default:!0}});var V=r(L,2),X=r(k(V),2),A=k(X),ue=k(A);ie(ue),B(),v(A);var q=r(A,2),ve=k(q);ie(ve),B(),v(q),v(X);var be=r(X,4),Y=k(be);ie(Y);var Ue=r(Y,2);tt(Ue,{class:"absolute top-1/2 -translate-y-1/2 right-4 text-[#939393] h-[20px] w-[20px]"}),v(be),v(V);var _e=r(V,2);{var Oe=c=>{var $=lt(),f=w($);$e(f,i=>s(n,i),()=>e(n));var p=r(f,2);we(p,5,I,ye,(i,W,h)=>{var E=ot(),D=w(E);const Z=H(()=>G(Pe("border-4 relative flex flex-row")));var ee=k(D);v(D);var J=r(D,2);{var te=re=>{var Ae=st();o(re,Ae)};le(J,re=>{(h+1)%4===0&&re(te)})}se(()=>{K(D,e(Z),""),xe(ee,"src","data:image/jpeg;base64,"+e(W))}),o(i,E)}),v(p);var x=r(p,2);$e(x,i=>s(_,i),()=>e(_));var u=r(x,2),N=H(()=>e(S)||I().length>=8);ke(u,{variant:"brand",class:"w-[70%] mx-auto",get disabled(){return e(N)},$$events:{click:Ce},children:(i,W)=>{B();var h=z("Capture photo");o(i,h)},$$slots:{default:!0}}),o(c,$)},Re=c=>{var $=dt(),f=r(w($),2),p=r(f,4);Xe(p,{id:"picture",type:"file",accept:"image/*",class:"cursor-pointer",$$events:{input:ge}});var x=r(p,2);we(x,5,I,ye,(u,N,i)=>{var W=nt(),h=w(W);const E=H(()=>G(Pe("border-4 relative flex flex-row")));var D=k(h);v(h);var Z=r(h,2);{var ee=J=>{var te=it();o(J,te)};le(Z,J=>{(i+1)%4===0&&J(ee)})}se(()=>{K(h,e(E),""),xe(D,"src","data:image/jpeg;base64,"+e(N))}),o(u,W)}),v(x),oe("input",f,ge),o(c,$)};le(_e,c=>{e(g)===1?c(Oe):c(Re,!1)})}var Fe=r(_e,2);rt(Fe,{children:(c,$)=>{var f=H(()=>I().length===0||e(P)==="");ke(c,{variant:"brand",type:"submit",get disabled(){return e(f)},$$events:{click:Te},children:(p,x)=>{B();var u=z("Add Person");o(p,u)},$$slots:{default:!0}})},$$slots:{default:!0}}),se(()=>{K(A,G(e(g)!==1?"text-[#00132B] dark:text-slate-300 flex-shrink-0 w-1/2 flex flex-row items-center h-[67px] px-4 py-2 justify-start gap-4 rounded-lg border-[1px] border-solid border-[rgb(145,158,171)]/[.24] font-medium text-sm ":" text-[#00132B] flex-shrink-0 w-1/2 flex flex-row items-center h-[67px] px-4 py-2 justify-start gap-4 rounded-lg border-[1px] border-solid border-[#136ad5] bg-[#ecf3fc] font-medium text-sm "),""),he(ue,e(g)===1),K(q,G(e(g)!==2?"text-[#00132B] dark:text-slate-300 flex-shrink-0 w-1/2 flex flex-row items-center h-[67px] px-4 py-2 justify-start gap-4 rounded-lg border-[1px] border-solid border-[rgb(145,158,171)]/[.24] font-medium text-sm":"text-[#00132B] flex-shrink-0 w-1/2 flex flex-row items-center h-[67px] px-4 py-2 justify-start gap-4 rounded-lg border-[1px] border-solid border-[#136ad5] bg-[#ecf3fc] font-medium text-sm"),""),he(ve,e(g)===2)}),oe("click",A,()=>s(g,1)),oe("click",q,()=>s(g,2)),He(Y,()=>e(P),c=>s(P,c)),o(O,F)},$$slots:{default:!0}}),o(t,l)},$$slots:{default:!0},$$legacy:!0}),Le()}export{Ot as R};
